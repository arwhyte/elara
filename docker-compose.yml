services:
  jupyter:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: elara
    image: elara:latest

    ports:
      - 8888:8888

    user: "1000:100"                  # Match UID:GID

    volumes:
      - ${PWD}:/home/jovyan/work      # Mount working directory

    environment:
      - JUPYTER_ENABLE_LAB=yes
      - NB_USER=jovyan
      - NB_UID=1000
      - NB_GID=100
      - JUPYTER_TOKEN=${JUPYTER_TOKEN:-devtoken}  # Use .env or fallback

    restart: unless-stopped         # Restart on reboot/failure

    command: >
      jupyter lab
      --ip=0.0.0.0
      --allow-root
      --ServerApp.open_browser=False
      --ServerApp.root_dir=/home/jovyan/work
      --ServerApp.token=${JUPYTER_TOKEN}
      --ServerApp.password=''
